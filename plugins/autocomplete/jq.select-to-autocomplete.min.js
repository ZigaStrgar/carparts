(function(d){var a={sort:false,"sort-attr":"data-priority","sort-desc":false,autoselect:true,"alternative-spellings":true,"alternative-spellings-attr":"data-alternative-spellings","remove-valueless-options":true,"copy-attributes-to-text-field":true,"autocomplete-plugin":"jquery_ui","relevancy-sorting":true,"relevancy-sorting-partial-match-value":1,"relevancy-sorting-strict-match-value":5,"relevancy-sorting-booster-attr":"data-relevancy-booster",handle_invalid_input:function(e){e.$text_field.val(e.$select_field.find("option:selected:first").text())},handle_select_field:function(e){return e.hide()},insert_text_field:function(k){var f=d("<input></input>");if(a["copy-attributes-to-text-field"]){var g={};var e=k.$select_field[0].attributes;for(var j=0;j<e.length;j++){var h=e[j].nodeName;var l=e[j].nodeValue;if(h!=="name"&&h!=="id"&&typeof k.$select_field.attr(h)!=="undefined"){g[h]=l}}f.attr(g)}f.blur(function(){var i=k.$select_field.find("option").map(function(m,n){return d(n).text()});if((d.inArray(f.val(),i)<0)&&typeof a.handle_invalid_input==="function"){a.handle_invalid_input(k)}});if(k.settings.autoselect){f.click(function(){this.select()})}return f.val(k.$select_field.find("option:selected:first").text()).insertAfter(k.$select_field)},extract_options:function(f){var h=[];var e=f.find("option");var g=e.length;e.each(function(){var l=d(this);var j={"real-value":l.attr("value"),label:l.text()};if(a["remove-valueless-options"]&&j["real-value"]===""){}else{j.matches=j.label;var m=l.attr(a["alternative-spellings-attr"]);if(m){j.matches+=" "+m}if(a.sort){var k=parseInt(l.attr(a["sort-attr"]),10);if(k){j.weight=k}else{j.weight=g}}if(a["relevancy-sorting"]){j["relevancy-score"]=0;j["relevancy-score-booster"]=1;var i=parseFloat(l.attr(a["relevancy-sorting-booster-attr"]));if(i){j["relevancy-score-booster"]=i}}h.push(j)}});if(a.sort){if(a["sort-desc"]){h.sort(function(j,i){return i.weight-j.weight})}else{h.sort(function(j,i){return j.weight-i.weight})}}return h}};var c={init:function(e){if(d.browser.msie&&parseInt(d.browser.version,10)<=6){return this}else{a=d.extend(a,e);return this.each(function(){var f=d(this);var g={"$select_field":f,options:a.extract_options(f),settings:a};g["$text_field"]=a.insert_text_field(g);a.handle_select_field(f);if(typeof a["autocomplete-plugin"]==="string"){b[a["autocomplete-plugin"]](g)}else{a["autocomplete-plugin"](g)}})}}};var b={jquery_ui:function(f){var g=function(k){var l=k.split(" ");var h=[];for(var j=0;j<l.length;j++){if(l[j].length>0){var m={};m.partial=new RegExp(d.ui.autocomplete.escapeRegex(l[j]),"i");if(f.settings["relevancy-sorting"]){m.strict=new RegExp("^"+d.ui.autocomplete.escapeRegex(l[j]),"i")}h.push(m)}}return d.grep(f.options,function(t){var n=0;if(f.settings["relevancy-sorting"]){var p=false;var s=t.matches.split(" ")}for(var r=0;r<h.length;r++){if(h[r]["partial"].test(t.matches)){n++}if(f.settings["relevancy-sorting"]){for(var u=0;u<s.length;u++){if(h[r]["strict"].test(s[u])){p=true;break}}}}if(f.settings["relevancy-sorting"]){var o=0;o+=n*f.settings["relevancy-sorting-partial-match-value"];if(p){o+=f.settings["relevancy-sorting-strict-match-value"]}o=o*t["relevancy-score-booster"];t["relevancy-score"]=o}return(!k||h.length===n)})};var e=function(j){if(j){if(f.$select_field.val()!==j["real-value"]){f.$select_field.val(j["real-value"]);f.$select_field.change()}}else{var k=f.$text_field.val().toLowerCase();var l={"real-value":false};for(var h=0;h<f.options.length;h++){if(k===f.options[h]["label"].toLowerCase()){l=f.options[h];break}}if(f.$select_field.val()!==l["real-value"]){f.$select_field.val(l["real-value"]||"");f.$select_field.change()}if(l["real-value"]){f.$text_field.val(l.label)}if(typeof f.settings.handle_invalid_input==="function"&&f.$select_field.val()===""){f.settings.handle_invalid_input(f)}}};f.$text_field.autocomplete({minLength:0,delay:0,autoFocus:true,source:function(i,h){var j=g(i.term);if(f.settings["relevancy-sorting"]){j=j.sort(function(l,k){return k["relevancy-score"]-l["relevancy-score"]})}h(j)},select:function(h,i){e(i.item)},change:function(h,i){e(i.item)}});f.$text_field.parents("form:first").submit(function(){e()});e()}};d.fn.selectToAutocomplete=function(e){if(c[e]){return c[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return c.init.apply(this,arguments)}else{d.error("Method "+e+" does not exist on jQuery.fn.selectToAutocomplete")}}}})(jQuery);