(function(){var b,a;b=jQuery;a=function(d,c){var e,h,g,f=this;this.options=b.extend({title:null,footer:null,remote:null},b.fn.ekkoLightbox.defaults,c||{});this.$element=b(d);e="";this.modal_id=this.options.modal_id?this.options.modal_id:"ekkoLightbox-"+Math.floor((Math.random()*1000)+1);g='<div class="modal-header"'+(this.options.title||this.options.always_show_close?"":' style="display:none"')+'><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+(this.options.title||"&nbsp;")+"</h4></div>";h='<div class="modal-footer"'+(this.options.footer?"":' style="display:none"')+">"+this.options.footer+"</div>";b(document.body).append('<div id="'+this.modal_id+'" class="ekko-lightbox modal fade" tabindex="-1"><div class="modal-dialog"><div class="modal-content">'+g+'<div class="modal-body"><div class="ekko-lightbox-container"><div></div></div></div>'+h+"</div></div></div>");this.modal=b("#"+this.modal_id);this.modal_dialog=this.modal.find(".modal-dialog").first();this.modal_content=this.modal.find(".modal-content").first();this.modal_body=this.modal.find(".modal-body").first();this.lightbox_container=this.modal_body.find(".ekko-lightbox-container").first();this.lightbox_body=this.lightbox_container.find("> div:first-child").first();this.showLoading();this.modal_arrows=null;this.border={top:parseFloat(this.modal_dialog.css("border-top-width"))+parseFloat(this.modal_content.css("border-top-width"))+parseFloat(this.modal_body.css("border-top-width")),right:parseFloat(this.modal_dialog.css("border-right-width"))+parseFloat(this.modal_content.css("border-right-width"))+parseFloat(this.modal_body.css("border-right-width")),bottom:parseFloat(this.modal_dialog.css("border-bottom-width"))+parseFloat(this.modal_content.css("border-bottom-width"))+parseFloat(this.modal_body.css("border-bottom-width")),left:parseFloat(this.modal_dialog.css("border-left-width"))+parseFloat(this.modal_content.css("border-left-width"))+parseFloat(this.modal_body.css("border-left-width"))};this.padding={top:parseFloat(this.modal_dialog.css("padding-top"))+parseFloat(this.modal_content.css("padding-top"))+parseFloat(this.modal_body.css("padding-top")),right:parseFloat(this.modal_dialog.css("padding-right"))+parseFloat(this.modal_content.css("padding-right"))+parseFloat(this.modal_body.css("padding-right")),bottom:parseFloat(this.modal_dialog.css("padding-bottom"))+parseFloat(this.modal_content.css("padding-bottom"))+parseFloat(this.modal_body.css("padding-bottom")),left:parseFloat(this.modal_dialog.css("padding-left"))+parseFloat(this.modal_content.css("padding-left"))+parseFloat(this.modal_body.css("padding-left"))};this.modal.on("show.bs.modal",this.options.onShow.bind(this)).on("shown.bs.modal",function(){f.modal_shown();return f.options.onShown.call(f)}).on("hide.bs.modal",this.options.onHide.bind(this)).on("hidden.bs.modal",function(){if(f.gallery){b(document).off("keydown.ekkoLightbox")}f.modal.remove();return f.options.onHidden.call(f)}).modal("show",c);return this.modal};a.prototype={modal_shown:function(){var c,d=this;if(!this.options.remote){return this.error("No remote target given")}else{this.gallery=this.$element.data("gallery");if(this.gallery){if(this.options.gallery_parent_selector==="document.body"||this.options.gallery_parent_selector===""){this.gallery_items=b(document.body).find('*[data-toggle="lightbox"][data-gallery="'+this.gallery+'"]')}else{this.gallery_items=this.$element.parents(this.options.gallery_parent_selector).first().find('*[data-toggle="lightbox"][data-gallery="'+this.gallery+'"]')}this.gallery_index=this.gallery_items.index(this.$element);b(document).on("keydown.ekkoLightbox",this.navigate.bind(this));if(this.options.directional_arrows&&this.gallery_items.length>1){this.lightbox_container.prepend('<div class="ekko-lightbox-nav-overlay"><a href="#" class="'+this.strip_stops(this.options.left_arrow_class)+'"></a><a href="#" class="'+this.strip_stops(this.options.right_arrow_class)+'"></a></div>');this.modal_arrows=this.lightbox_container.find("div.ekko-lightbox-nav-overlay").first();this.lightbox_container.find("a"+this.strip_spaces(this.options.left_arrow_class)).on("click",function(e){e.preventDefault();return d.navigate_left()});this.lightbox_container.find("a"+this.strip_spaces(this.options.right_arrow_class)).on("click",function(e){e.preventDefault();return d.navigate_right()})}}if(this.options.type){if(this.options.type==="image"){return this.preloadImage(this.options.remote,true)}else{if(this.options.type==="youtube"&&(c=this.getYoutubeId(this.options.remote))){return this.showYoutubeVideo(c)}else{if(this.options.type==="vimeo"){return this.showVimeoVideo(this.options.remote)}else{if(this.options.type==="instagram"){return this.showInstagramVideo(this.options.remote)}else{if(this.options.type==="url"){return this.showInstagramVideo(this.options.remote)}else{return this.error('Could not detect remote target type. Force the type using data-type="image|youtube|vimeo|url"')}}}}}}else{return this.detectRemoteType(this.options.remote)}}},strip_stops:function(c){return c.replace(/\./g,"")},strip_spaces:function(c){return c.replace(/\s/g,"")},isImage:function(c){return c.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSwf:function(c){return c.match(/\.(swf)((\?|#).*)?$/i)},getYoutubeId:function(d){var c;c=d.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);if(c&&c[2].length===11){return c[2]}else{return false}},getVimeoId:function(c){if(c.indexOf("vimeo")>0){return c}else{return false}},getInstagramId:function(c){if(c.indexOf("instagram")>0){return c}else{return false}},navigate:function(c){c=c||window.event;if(c.keyCode===39||c.keyCode===37){if(c.keyCode===39){return this.navigate_right()}else{if(c.keyCode===37){return this.navigate_left()}}}},navigateTo:function(c){var d,e;if(c<0||c>this.gallery_items.length-1){return this}this.showLoading();this.gallery_index=c;this.options.onNavigate.call(this,this.gallery_index);this.$element=b(this.gallery_items.get(this.gallery_index));this.updateTitleAndFooter();e=this.$element.attr("data-remote")||this.$element.attr("href");this.detectRemoteType(e,this.$element.attr("data-type")||false);if(this.gallery_index+1<this.gallery_items.length){d=b(this.gallery_items.get(this.gallery_index+1),false);e=d.attr("data-remote")||d.attr("href");if(d.attr("data-type")==="image"||this.isImage(e)){return this.preloadImage(e,false)}}},navigate_left:function(){if(this.gallery_items.length===1){return}if(this.gallery_index===0){this.gallery_index=this.gallery_items.length-1}else{this.gallery_index--}this.options.onNavigate.call(this,"left",this.gallery_index);return this.navigateTo(this.gallery_index)},navigate_right:function(){if(this.gallery_items.length===1){return}if(this.gallery_index===this.gallery_items.length-1){this.gallery_index=0}else{this.gallery_index++}this.options.onNavigate.call(this,"right",this.gallery_index);return this.navigateTo(this.gallery_index)},detectRemoteType:function(e,d){var c;if(d==="image"||this.isImage(e)){this.options.type="image";return this.preloadImage(e,true)}else{if(d==="youtube"||(c=this.getYoutubeId(e))){this.options.type="youtube";return this.showYoutubeVideo(c)}else{if(d==="vimeo"||(c=this.getVimeoId(e))){this.options.type="vimeo";return this.showVimeoVideo(c)}else{if(d==="instagram"||(c=this.getInstagramId(e))){this.options.type="instagram";return this.showInstagramVideo(c)}else{if(d==="url"||(c=this.getInstagramId(e))){this.options.type="instagram";return this.showInstagramVideo(c)}else{this.options.type="url";return this.loadRemoteContent(e)}}}}}},updateTitleAndFooter:function(){var c,f,e,d;e=this.modal_content.find(".modal-header");f=this.modal_content.find(".modal-footer");d=this.$element.data("title")||"";c=this.$element.data("footer")||"";if(d||this.options.always_show_close){e.css("display","").find(".modal-title").html(d||"&nbsp;")}else{e.css("display","none")}if(c){f.css("display","").html(c)}else{f.css("display","none")}return this},showLoading:function(){this.lightbox_body.html('<div class="modal-loading">Loading..</div>');return this},showYoutubeVideo:function(f){var e,c,d;e=560/315;d=this.$element.data("width")||560;d=this.checkDimensions(d);c=d/e;this.resize(d);this.lightbox_body.html('<iframe width="'+d+'" height="'+c+'" src="//www.youtube.com/embed/'+f+'?badge=0&autoplay=1&html5=1" frameborder="0" allowfullscreen></iframe>');this.options.onContentLoaded.call(this);if(this.modal_arrows){return this.modal_arrows.css("display","none")}},showVimeoVideo:function(f){var e,c,d;e=500/281;d=this.$element.data("width")||560;d=this.checkDimensions(d);c=d/e;this.resize(d);this.lightbox_body.html('<iframe width="'+d+'" height="'+c+'" src="'+f+'?autoplay=1" frameborder="0" allowfullscreen></iframe>');this.options.onContentLoaded.call(this);if(this.modal_arrows){return this.modal_arrows.css("display","none")}},showInstagramVideo:function(d){var c;c=this.$element.data("width")||612;c=this.checkDimensions(c);this.resize(c);this.lightbox_body.html('<iframe width="'+c+'" height="'+c+'" src="'+this.addTrailingSlash(d)+'embed/" frameborder="0" allowfullscreen></iframe>');this.options.onContentLoaded.call(this);if(this.modal_arrows){return this.modal_arrows.css("display","none")}},loadRemoteContent:function(d){var c,e,f=this;e=this.$element.data("width")||560;this.resize(e);c=this.$element.data("disableExternalCheck")||false;console.log(c,this.isExternal(d));if(!c&&!this.isExternal(d)){this.lightbox_body.load(d,b.proxy(function(){return f.$element.trigger("loaded.bs.modal")}))}else{this.lightbox_body.html('<iframe width="'+e+'" height="'+e+'" src="'+d+'" frameborder="0" allowfullscreen></iframe>');this.options.onContentLoaded.call(this)}if(this.modal_arrows){return this.modal_arrows.css("display","block")}},isExternal:function(d){var c;c=d.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof c[1]==="string"&&c[1].length>0&&c[1].toLowerCase()!==location.protocol){return true}if(typeof c[2]==="string"&&c[2].length>0&&c[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host){return true}return false},error:function(c){this.lightbox_body.html(c);return this},preloadImage:function(e,d){var c,f=this;c=new Image();if((d==null)||d===true){c.onload=function(){var g;g=b("<img />");g.attr("src",c.src);g.addClass("img-responsive");f.lightbox_body.html(g);if(f.modal_arrows){f.modal_arrows.css("display","block")}f.resize(c.width);return f.options.onContentLoaded.call(f)};c.onerror=function(){return f.error("Failed to load image: "+e)}}c.src=e;return c},resize:function(d){var c;c=d+this.border.left+this.padding.left+this.padding.right+this.border.right;this.modal_dialog.css("width","auto").css("max-width",c);this.lightbox_container.find("a").css("padding-top",function(){return b(this).parent().height()/2});return this},checkDimensions:function(e){var c,d;d=e+this.border.left+this.padding.left+this.padding.right+this.border.right;c=document.body.clientWidth;if(d>c){e=this.modal_body.width()}return e},close:function(){return this.modal.modal("hide")},addTrailingSlash:function(c){if(c.substr(-1)!=="/"){c+="/"}return c}};b.fn.ekkoLightbox=function(c){return this.each(function(){var d;d=b(this);c=b.extend({remote:d.attr("data-remote")||d.attr("href"),gallery_parent_selector:d.attr("data-parent"),type:d.attr("data-type")},c,d.data());new a(this,c);return this})};b.fn.ekkoLightbox.defaults={gallery_parent_selector:"*:not(.row)",left_arrow_class:".glyphicon .glyphicon-chevron-left",right_arrow_class:".glyphicon .glyphicon-chevron-right",directional_arrows:true,type:null,always_show_close:true,onShow:function(){},onShown:function(){},onHide:function(){},onHidden:function(){},onNavigate:function(){},onContentLoaded:function(){}}}).call(this);